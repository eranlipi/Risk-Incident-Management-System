<?xml version="1.0" encoding="utf-8"?>
<configuration>
<connectionStrings>
    <add name="IncidentDB"
         connectionString="Server=(localdb)\MSSQLLocalDB;Database=IncidentManagement;Integrated Security=true;"
         providerName="System.Data.SqlClient" />
</connectionStrings>

  <appSettings>
    <!-- Email Alert Settings -->
    <add key="AlertEmail.Enabled" value="true" />
    <add key="AlertEmail.CriticalSeverityThreshold" value="4" />
    <add key="AlertEmail.Recipients" value="safety@company.com" />

    <!-- SMTP Configuration -->
    <add key="SMTP.Host" value="smtp.gmail.com" />
    <add key="SMTP.Port" value="587" />
    <add key="SMTP.EnableSSL" value="true" />
    <add key="SMTP.Username" value="your-email@gmail.com" />
    <add key="SMTP.Password" value="your-app-password" />
    <add key="SMTP.FromAddress" value="noreply@company.com" />
    <add key="SMTP.FromName" value="Incident Management System" />

    <!-- Application Settings -->
    <add key="PageSize" value="20" />
    <add key="MaxExportRecords" value="10000" />
    <add key="SessionTimeout" value="30" />

    <!-- Feature Flags -->
    <add key="Features.EmailNotifications" value="true" />
    <add key="Features.ExcelExport" value="true" />
    <add key="Features.Dashboard" value="true" />
  </appSettings>

  <system.web>
    <compilation debug="true" targetFramework="4.7.2">
      <codeSubDirectories>
        <!-- Empty - disable App_Code automatic compilation -->
      </codeSubDirectories>
    </compilation>
    <httpRuntime targetFramework="4.7.2" maxRequestLength="10240" executionTimeout="600" />

    <!-- Session Configuration -->
    <sessionState mode="InProc" timeout="30" />

    <!-- Authentication -->
    <authentication mode="Forms">
      <forms loginUrl="~/Login.aspx" timeout="30" slidingExpiration="true" />
    </authentication>

    <!-- Custom Error Pages -->
    <customErrors mode="RemoteOnly" defaultRedirect="~/Error.aspx">
      <error statusCode="404" redirect="~/NotFound.aspx" />
      <error statusCode="500" redirect="~/Error.aspx" />
    </customErrors>

    <!-- Pages Configuration -->
    <pages controlRenderingCompatibilityVersion="4.0" clientIDMode="AutoID">
      <controls>
        <add tagPrefix="uc" tagName="IncidentSummary" src="~/Controls/IncidentSummary.ascx" />
        <add tagPrefix="uc" tagName="FilterPanel" src="~/Controls/FilterPanel.ascx" />
      </controls>
    </pages>

    <!-- Globalization -->
    <globalization culture="en-US" uiCulture="en-US" />

    <!-- Security -->
    <httpCookies httpOnlyCookies="true" requireSSL="false" />
    <trace enabled="false" localOnly="true" pageOutput="false" />
  </system.web>

  <system.webServer>
    <modules runAllManagedModulesForAllRequests="true" />

    <!-- Default Document -->
    <defaultDocument>
      <files>
        <clear />
        <add value="Default.aspx" />
        <add value="index.html" />
      </files>
    </defaultDocument>

    <!-- Static Content Caching -->
    <staticContent>
      <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="7.00:00:00" />
    </staticContent>

    <!-- URL Rewrite (Optional) -->
    <!--
    <rewrite>
      <rules>
        <rule name="RedirectToHTTPS" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="off" ignoreCase="true" />
          </conditions>
          <action type="Redirect" url="https://{SERVER_NAME}/{R:1}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>
    -->

    <!-- Security Headers -->
    <httpProtocol>
      <customHeaders>
        <add name="X-Content-Type-Options" value="nosniff" />
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <add name="X-XSS-Protection" value="1; mode=block" />
      </customHeaders>
    </httpProtocol>
  </system.webServer>

  <!-- System.Net Configuration for Email -->
  <system.net>
    <mailSettings>
      <smtp deliveryMethod="Network">
        <network host="smtp.gmail.com" port="587" enableSsl="true"
                 userName="your-email@gmail.com" password="your-app-password" />
      </smtp>
    </mailSettings>
  </system.net>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <!-- Add assembly redirects here if needed -->
    </assemblyBinding>
  </runtime>
</configuration>
